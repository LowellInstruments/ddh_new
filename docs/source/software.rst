.. _software:


Software
========

The software is entirely written in Python3 and comprises a Graphical User Interface, or GUI,
which main screen is shown next, built on top of a so-called MAT library from Lowell Instruments.

.. image:: ddh_screenshot.png
    :width: 700px
    :align: center
    :height: 440px
    :alt: DDH screenshot

Loggers are intended to be attached to fishing equipment such as cages. As an application
example, when a fisherman arrives to a fishing spot, it recovers its lobster cage and hauls
it up to the fishing vessel. When the onboard DDH detects a logger, it records its current GPS position. Then,
it stops the logger, which probably has been running for months. Next, it downloads,
checks and converts the binary data files in the logger as a CSV friendly format. Finally,
it re-setups the logger, performs sanity configuration checks and re-runs it so if the cage is re-deployed
the next data files recovered will start at the current precise time.

DDH are delivered with all the software already pre-installed. However, the software
installation procedure and details can be seen in the
`DDH project github page <https://github.com/LowellInstruments/ddh>`_.


Configuring a DDH
#################

The DDH behavior is configured in a single configuration named ddh.json.
In the following snippet, we highlight the most important lines.

.. code-block:: JSON
   :linenos:
   :emphasize-lines: 4,8,9,10,11

    {
        "comment": "auto-generated by DDH setup tab, do not edit",
        "db_logger_macs": {
            "60:77:71:22:C8:08": "2006671",
            "60:77:71:22:C8:18": "house",
        },
        "ship_name": "My boat!",
        "forget_time": 86400,
        "forget_time_at_sea": 900,
        "units": "F",
        "hci_if": 0,
        ...
        }
    }

The 'db_logger_macs' entry contains the whitelist of loggers which a DDH
recognizes and will query upon detection. Each logger entry comprises its MAC
address and its friendly name.

Line 8, 'forget_time', in seconds, represents for how long a DDH will ignore a
logger once it is detected, downloaded and re-configured. This prevents the DDH from
constantly detecting and interacting with the same loggers. This setting
is for when the DDH is inland, or maybe at a lab.

Line 9, 'forget_time_at_sea', represents the same concept as 'forget_time'. However,
this value is used when the DDH is at sea. This setting prevents the DDH from ignoring
a logger too much time when it is being transferred from one location
at sea to the next one. An excessively long value, such as forget_time, could
make the DDH log the last location of the logger as too far away.

Line 10, 'units', allows the data plots to be shown in 'F', for Fahrenheit, or 'C', for Celsius.

Line 11, 'hci_if', allows the DDH to user an external HCI Linux interface when set as 1, or an
internal one, when set as 0 as in the example. An external HCI Linux Bluetooth interface
is commonly a USB dongle, which needs to implement Bluetooth Low Energy.

The 'ddh.json' file is longer, although the rest of parameters have been omitted
from this explanation since they are not intended to be modified by the final user.


